# リバーシ合法手判定プログラム - タスクリスト（BDD/TDD 2重ループ）

## 概要

このタスクリストは、**BDD（振る舞い駆動開発）とTDD（テスト駆動開発）の2重ループ**で開発を進めます。

### 開発アプローチ

1. **外側のループ（BDD）**: 統合テスト（受入基準のテスト）
   - **Red**: 失敗する統合テストを書く
   - **Green**: 統合テストをパスさせる（内側のループを回す）
   - **Refactor**: リファクタリング

2. **内側のループ（TDD）**: ユニットテスト
   - **Red**: 失敗するユニットテストを書く
   - **振る舞い駆動**: ケントベック流のTDD - 振る舞いで記述
   - **Green**: ユニットテストをパスさせる
   - **Refactor**: リファクタリング

### タスク完了時の手順

**各タスク完了時には必ず以下を実行**:
1. このtasks.mdのステータスを更新（⏳ → 🔄 → ✅）
2. Git コミット（タスク番号を含む明確なメッセージ）

## タスクステータス

- ⏳ **未着手**: まだ開始していない
- 🔄 **実施中**: 現在作業中
- ✅ **完了**: 完了済み

---

## フェーズ0: 環境準備

### タスク0-1: プロジェクト構造とテストファイルの骨格作成

**目的**: BDD/TDD開発の基盤を準備

**作業内容**:
1. 必要なディレクトリ構造を確認
2. `test_reversi.py` ファイルを作成
3. 必要なimport文を追加:
   ```python
   import pytest  # あれば
   ```
4. テストファイルの骨格を作成（空の状態で良い）
5. `reversi_core.py` と `reversi.py` の空ファイルを作成（テストがimportできるように）
6. **tasks.md を更新**（このタスクを ✅ に変更）
7. **Git コミット**

**完了定義**:
- [x] test_reversi.py, reversi_core.py, reversi.py が存在する
- [x] Pythonの構文エラーがない
- [x] tasks.md が更新されている
- [x] Git コミット済み

**状態**: ✅ 完了

**コミットメッセージ例**:
```
test(task-0-1): プロジェクト構造とテストファイル骨格を作成

- test_reversi.py, reversi_core.py, reversi.py を作成
- tasks.md を更新（タスク0-1完了）
```

---

## 外側のループ1: AC-001（初期配置・黒番の合法手判定）

### タスク1-1: 統合テスト作成（Red - 外側のループ）

**目的**: spec.md の AC-001 を統合テストとして実装（失敗することを確認）

**作業内容**:
1. `test_reversi.py` に以下のテストを追加:
   ```python
   def test_初期配置で黒番の合法手を正しく表示する():
       """
       Given: 盤面が初期配置である
       And: 手番が黒（B）である
       When: プログラムを実行する
       Then: 4箇所の合法手が '0' でマークされる
       """
   ```
2. spec.md の AC-001 の盤面データを作成
3. `reversi.py` の `main()` または統合的な関数を呼び出すテストを書く
4. **pytest を実行して失敗することを確認**（Red状態）
5. **tasks.md を更新**（このタスクを ✅ に変更）
6. **Git コミット**

**完了定義**:
- [x] テスト関数が実装されている
- [x] Given-When-Then 形式のdocstringがある
- [x] pytest 実行で失敗する（まだ実装がないため）
- [x] tasks.md が更新されている
- [x] Git コミット済み

**状態**: ✅ 完了

**コミットメッセージ例**:
```
test(task-1-1): AC-001の統合テストを作成（Red）

- 初期配置・黒番の合法手判定テストを追加
- Given-When-Then 形式で記述
- pytest で失敗を確認（Red状態）
- tasks.md を更新（タスク1-1完了）
```

---

## 内側のループ1-A: can_place_and_flip 関数（TDD）

### タスク1-2: can_place_and_flip のユニットテスト作成（Red）

**目的**: 合法手判定の振る舞いをテストで表現

**作業内容**:
1. `test_reversi.py` に以下のユニットテストを追加:
   ```python
   def test_空マスで相手のコマを挟める場合は合法手と判定する():
       """隣接マスに相手のコマがあり、その先に自分のコマがある場合"""
       pass

   def test_既にコマがある位置は合法手ではないと判定する():
       """空マスでない場合は False"""
       pass

   def test_どの方向にも相手のコマを挟めない場合は合法手ではないと判定する():
       """8方向すべてチェックしても挟めない場合は False"""
       pass

   def test_盤面外の位置は合法手ではないと判定する():
       """範囲外の座標は False"""
       pass
   ```
2. 各テストで具体的な盤面データを作成
3. `from reversi_core import can_place_and_flip` を追加
4. **pytest を実行して失敗することを確認**（Red状態）
5. **tasks.md を更新**
6. **Git コミット**

**完了定義**:
- [x] 4つのユニットテストが追加されている
- [x] 各テストが振る舞いを表す名前になっている
- [x] pytest 実行で失敗する
- [x] tasks.md が更新されている
- [x] Git コミット済み

**状態**: ✅ 完了

**コミットメッセージ例**:
```
test(task-1-2): can_place_and_flip のユニットテストを作成（Red）

- 4つの振る舞いテストを追加
- 振る舞いで記述（ケントベック流）
- pytest で失敗を確認（Red状態）
- tasks.md を更新（タスク1-2完了）
```

---

### タスク1-3: can_place_and_flip 関数の実装（Green）

**目的**: ユニットテストをパスさせる実装

**作業内容**:
1. `reversi_core.py` に `can_place_and_flip` 関数を実装:
   - 型ヒント、docstring を追加
   - 範囲チェック
   - 空マスチェック
   - 8方向のループ処理
   - 相手のコマを挟める判定
2. **pytest を実行してユニットテストがパスすることを確認**（Green状態）
3. **tasks.md を更新**
4. **Git コミット**

**完了定義**:
- [x] can_place_and_flip 関数が実装されている
- [x] タスク1-2のすべてのユニットテストがパスする
- [x] tasks.md が更新されている
- [x] Git コミット済み

**状態**: ✅ 完了

**コミットメッセージ例**:
```
feat(task-1-3): can_place_and_flip 関数を実装（Green）

- 合法手判定ロジックを実装
- 8方向すべてをチェック
- ユニットテストがパス（Green状態）
- tasks.md を更新（タスク1-3完了）
```

---

### タスク1-4: can_place_and_flip 関数のリファクタリング（Refactor）

**目的**: コードの品質向上

**作業内容**:
1. コードレビュー（自己レビュー）:
   - 変数名の明確さ
   - コメントの適切性
   - 重複コードの削除
2. 必要に応じてリファクタリング
3. **pytest を実行してテストが通ることを確認**
4. **tasks.md を更新**
5. **Git コミット**

**完了定義**:
- [x] リファクタリング実施（変更がない場合もOK）
- [x] すべてのテストがパスする
- [x] tasks.md が更新されている
- [x] Git コミット済み

**状態**: ✅ 完了

**コミットメッセージ例**:
```
refactor(task-1-4): can_place_and_flip をリファクタリング（Refactor）

- 変数名を明確化
- テストがパスすることを確認
- tasks.md を更新（タスク1-4完了）
```

---

## 内側のループ1-B: find_legal_moves 関数（TDD）

### タスク1-5: find_legal_moves のユニットテスト作成（Red）

**目的**: 全合法手列挙の振る舞いをテストで表現

**作業内容**:
1. `test_reversi.py` に以下のユニットテストを追加:
   ```python
   def test_初期配置で黒番は4つの合法手を持つ():
       """初期配置・黒番の場合、(2,4), (3,5), (4,2), (5,3) が合法手"""
       pass

   def test_初期配置で白番は4つの合法手を持つ():
       """初期配置・白番の場合、(2,3), (3,2), (4,5), (5,4) が合法手"""
       pass

   def test_合法手がない場合は空リストを返す():
       """どこにも置けない盤面の場合、[] を返す"""
       pass
   ```
2. `from reversi_core import find_legal_moves` を追加
3. **pytest を実行して失敗することを確認**（Red状態）
4. **tasks.md を更新**
5. **Git コミット**

**完了定義**:
- [x] 3つのユニットテストが追加されている
- [x] pytest 実行で失敗する
- [x] tasks.md が更新されている
- [x] Git コミット済み

**状態**: ✅ 完了

**コミットメッセージ例**:
```
test(task-1-5): find_legal_moves のユニットテストを作成（Red）

- 3つの振る舞いテストを追加
- pytest で失敗を確認（Red状態）
- tasks.md を更新（タスク1-5完了）
```

---

### タスク1-6: find_legal_moves 関数の実装（Green）

**目的**: ユニットテストをパスさせる実装

**作業内容**:
1. `reversi_core.py` に `find_legal_moves` 関数を実装:
   - 型ヒント、docstring を追加
   - 64マスをループ
   - `can_place_and_flip` を呼び出し
   - 合法手のリストを構築
2. **pytest を実行してユニットテストがパスすることを確認**（Green状態）
3. **tasks.md を更新**
4. **Git コミット**

**完了定義**:
- [x] find_legal_moves 関数が実装されている
- [x] タスク1-5のすべてのユニットテストがパスする
- [x] tasks.md が更新されている
- [x] Git コミット済み

**状態**: ✅ 完了

**コミットメッセージ例**:
```
feat(task-1-6): find_legal_moves 関数を実装（Green）

- 全合法手列挙ロジックを実装
- ユニットテストがパス（Green状態）
- tasks.md を更新（タスク1-6完了）
```

---

### タスク1-7: find_legal_moves 関数のリファクタリング（Refactor）

**目的**: コードの品質向上

**作業内容**:
1. コードレビュー（自己レビュー）
2. 必要に応じてリファクタリング
3. **pytest を実行してテストが通ることを確認**
4. **tasks.md を更新**
5. **Git コミット**

**完了定義**:
- [x] リファクタリング実施（変更がない場合もOK）
- [x] すべてのテストがパスする
- [x] tasks.md が更新されている
- [x] Git コミット済み

**状態**: ✅ 完了

**コミットメッセージ例**:
```
refactor(task-1-7): find_legal_moves をリファクタリング（Refactor）

- コードの可読性向上
- テストがパスすることを確認
- tasks.md を更新（タスク1-7完了）
```

---

## 内側のループ1-C: 入出力処理（TDD）

### タスク1-8: read_input と write_output のテスト作成と実装（Red → Green）

**目的**: 入出力処理を実装

**作業内容**:
1. `test_reversi.py` に入出力のユニットテストを追加:
   ```python
   def test_標準入力から盤面と手番を読み込める():
       """9行の入力を盤面データと手番に変換"""
       pass
   ```
2. **pytest を実行して失敗確認**（Red）
3. `reversi.py` に以下を実装:
   - `read_input()` 関数
   - `write_output()` 関数
   - 型ヒント、docstring
4. **pytest を実行してパス確認**（Green）
5. **tasks.md を更新**
6. **Git コミット**

**完了定義**:
- [x] 入出力関数が実装されている
- [x] テストがパスする
- [x] tasks.md が更新されている
- [x] Git コミット済み

**状態**: ✅ 完了

**コミットメッセージ例**:
```
feat(task-1-8): 入出力処理を実装（Red → Green）

- read_input, write_output を実装
- テストがパス（Green状態）
- tasks.md を更新（タスク1-8完了）
```

---

### タスク1-9: main 関数の実装

**目的**: プログラムの統合

**作業内容**:
1. `reversi.py` に `main()` 関数を実装:
   - `read_input()` を呼び出し
   - `find_legal_moves()` を呼び出し
   - `write_output()` を呼び出し
2. `if __name__ == "__main__":` ブロックを追加
3. **tasks.md を更新**
4. **Git コミット**

**完了定義**:
- [x] main 関数が実装されている
- [x] プログラムが実行可能
- [x] tasks.md が更新されている
- [x] Git コミット済み

**状態**: ✅ 完了

**コミットメッセージ例**:
```
feat(task-1-9): main 関数を実装して統合

- read_input → find_legal_moves → write_output
- tasks.md を更新（タスク1-9完了）
```

---

### タスク1-10: 統合テスト確認（Green - 外側のループ）

**目的**: タスク1-1で書いた統合テストがパスすることを確認

**作業内容**:
1. **pytest を実行**
2. **タスク1-1の統合テスト（AC-001）がパスすることを確認**（Green状態）
3. パスしない場合は修正
4. **tasks.md を更新**
5. **Git コミット**

**完了定義**:
- [x] タスク1-1の統合テストがパスする
- [x] すべてのユニットテストもパスする
- [x] tasks.md が更新されている
- [x] Git コミット済み

**状態**: ⏳ 未着手

**コミットメッセージ例**:
```
test(task-1-10): AC-001の統合テストがパス（Green）

- 外側のループ完了
- すべてのテストがパス
- tasks.md を更新（タスク1-10完了）
```

---

### タスク1-11: リファクタリング（Refactor - 外側のループ）

**目的**: 全体のコード品質向上

**作業内容**:
1. コードレビュー（全体を見直し）:
   - 重複コードの削減
   - 変数名、関数名の明確化
   - コメントの追加・修正
2. 必要に応じてリファクタリング
3. **pytest を実行してすべてのテストが通ることを確認**
4. **tasks.md を更新**
5. **Git コミット**

**完了定義**:
- [x] リファクタリング実施
- [x] すべてのテストがパスする
- [x] tasks.md が更新されている
- [x] Git コミット済み

**状態**: ⏳ 未着手

**コミットメッセージ例**:
```
refactor(task-1-11): 全体をリファクタリング（Refactor）

- コードの可読性向上
- すべてのテストがパス
- tasks.md を更新（タスク1-11完了）
```

---

## 外側のループ2: AC-002（初期配置・白番の合法手判定）

### タスク2-1: AC-002の統合テスト作成（Red - 外側のループ）

**目的**: spec.md の AC-002 を統合テストとして実装

**作業内容**:
1. `test_reversi.py` に以下のテストを追加:
   ```python
   def test_初期配置で白番の合法手を正しく表示する():
       """
       Given: 盤面が初期配置である
       And: 手番が白（W）である
       When: プログラムを実行する
       Then: 4箇所の合法手が '0' でマークされる
       """
   ```
2. spec.md の AC-002 のテストデータを作成
3. **pytest を実行**
4. **tasks.md を更新**
5. **Git コミット**

**完了定義**:
- [x] テスト関数が実装されている
- [x] pytest 実行で成功する（すでに実装済みのため）
- [x] tasks.md が更新されている
- [x] Git コミット済み

**状態**: ⏳ 未着手

**コミットメッセージ例**:
```
test(task-2-1): AC-002の統合テストを追加

- 初期配置・白番のテスト
- すでに実装済みのためパス
- tasks.md を更新（タスク2-1完了）
```

---

## 外側のループ3: AC-003（合法手がない場合）

### タスク3-1: AC-003の統合テスト作成と確認（Red → Green）

**目的**: spec.md の AC-003 を統合テストとして実装

**作業内容**:
1. `test_reversi.py` に以下のテストを追加:
   ```python
   def test_合法手がない場合は0をマークしない():
       """
       Given: 盤面上にどこに置いても相手のコマがひっくり返らない状態
       When: プログラムを実行する
       Then: 出力された盤面に '0' のマークがない
       """
   ```
2. 合法手がない盤面データを作成
3. **pytest を実行**
4. **tasks.md を更新**
5. **Git コミット**

**完了定義**:
- [x] テスト関数が実装されている
- [x] pytest でパスする
- [x] tasks.md が更新されている
- [x] Git コミット済み

**状態**: ⏳ 未着手

**コミットメッセージ例**:
```
test(task-3-1): AC-003の統合テストを追加

- 合法手なしのテスト
- テストがパス
- tasks.md を更新（タスク3-1完了）
```

---

## 外側のループ4: AC-004, AC-005（エッジケース）

### タスク4-1: AC-004, AC-005のテスト追加（Red → Green）

**目的**: エッジケースのテストを追加

**作業内容**:
1. `test_reversi.py` に以下のテストを追加:
   ```python
   def test_複数方向にひっくり返せる場合も正しく判定する():
       """AC-004: 1つの手で複数方向にひっくり返せる場合"""
       pass

   def test_端や角での合法手判定がエラーなく動作する():
       """AC-005: 盤面の端や角でも正しく判定"""
       pass
   ```
2. spec.md の AC-004, AC-005 のテストデータを作成
3. **pytest を実行**
4. **tasks.md を更新**
5. **Git コミット**

**完了定義**:
- [x] 2つのテスト関数が実装されている
- [x] pytest でパスする
- [x] tasks.md が更新されている
- [x] Git コミット済み

**状態**: ⏳ 未着手

**コミットメッセージ例**:
```
test(task-4-1): AC-004, AC-005のテストを追加

- エッジケースのテスト
- すべてのテストがパス
- tasks.md を更新（タスク4-1完了）
```

---

## フェーズ5: 最終検証とドキュメント

### タスク5-1: 全テストの実行と手動確認

**目的**: すべての受入基準を満たすことを確認

**作業内容**:
1. **pytest を実行してすべてのテストがパスすることを確認**
2. 手動テスト:
   - spec.md の AC-001 の入力例で `python reversi.py` を実行
   - 出力が期待通りか確認
3. **tasks.md を更新**
4. **Git コミット**

**完了定義**:
- [x] すべてのテストがパスする
- [x] 手動テストで正しい出力が得られる
- [x] tasks.md が更新されている
- [x] Git コミット済み

**状態**: ⏳ 未着手

**コミットメッセージ例**:
```
test(task-5-1): 全テストと手動確認を実施

- すべてのテストがパス
- 手動テストで動作確認
- tasks.md を更新（タスク5-1完了）
```

---

### タスク5-2: README.md の作成

**目的**: spec_driven アプローチのドキュメント作成

**作業内容**:
1. `README.md` ファイルを作成
2. 以下の内容を記載:
   - アプローチの概要（BDD/TDD 2重ループ）
   - ファイル構成
   - セットアップ方法
   - 実行方法
   - テスト実行方法
   - 開発の流れ（spec.md → plan.md → tasks.md → 実装）
3. **tasks.md を更新**
4. **Git コミット**

**完了定義**:
- [x] README.md が作成されている
- [x] 必要な情報が記載されている
- [x] tasks.md が更新されている
- [x] Git コミット済み

**状態**: ⏳ 未着手

**コミットメッセージ例**:
```
docs(task-5-2): README.md を作成

- BDD/TDD 2重ループの説明
- 使い方、テスト方法を記載
- tasks.md を更新（タスク5-2完了）
```

---

### タスク5-3: 最終リファクタリングとコミット

**目的**: 最終的なコード品質確認

**作業内容**:
1. 全体のコードレビュー
2. 必要に応じて最終リファクタリング
3. **pytest を実行してすべてのテストがパスすることを確認**
4. **tasks.md を更新**（すべてのタスクが ✅ であることを確認）
5. **最終 Git コミット**

**完了定義**:
- [x] すべてのファイルが完成している
- [x] すべてのテストがパスする
- [x] tasks.md がすべて ✅ になっている
- [x] Git コミット済み

**状態**: ⏳ 未着手

**コミットメッセージ例**:
```
refactor(task-5-3): 最終リファクタリングと完成

- 全体の最終確認
- すべてのテストがパス
- tasks.md を更新（全タスク完了）
```

---

## 進捗サマリー

**完了タスク数**: 3 / 18

**フェーズ別進捗**:
- フェーズ0（環境準備）: 1 / 1
- 外側のループ1（AC-001）: 2 / 11
- 外側のループ2（AC-002）: 0 / 1
- 外側のループ3（AC-003）: 0 / 1
- 外側のループ4（AC-004, AC-005）: 0 / 1
- フェーズ5（最終検証）: 0 / 3

---

## TDDサイクルの確認

各タスクで以下のサイクルを忘れずに実行：

1. **Red**: 失敗するテストを書く
2. **Green**: テストをパスさせる最小限の実装
3. **Refactor**: コードの品質向上
4. **tasks.md 更新**: ステータスを ✅ に変更
5. **Git コミット**: タスク番号を含むメッセージ

---

## 重要な原則

1. **振る舞い駆動**: テスト名は振る舞いを表現（ケントベック流）
2. **2重ループ**: 外側（BDD/統合テスト）と内側（TDD/ユニットテスト）
3. **毎タスクコミット**: 必ず tasks.md を更新してコミット
4. **テストファースト**: 実装の前にテストを書く
5. **最小実装**: テストをパスさせる最小限の実装
