# リバーシ合法手判定プログラム - 仕様書

## 1. プロジェクト概要

### システムの目的
リバーシ（オセロ）ゲームにおいて、現在の盤面状態と手番の情報から、そのプレイヤーにとって合法な手（コマを置ける位置）を判定し、一覧表示するプログラムを提供する。

### 対象ユーザー
- リバーシゲームのプレイヤー
- リバーシゲームの実装者・開発者
- リバーシゲームのルールを学習したい人

### ビジネス価値
- プレイヤーが合法手を素早く把握できることで、ゲームプレイがスムーズになる
- ルールの誤解や不正な手を防ぐことができる
- リバーシゲームの実装において、合法手判定ロジックを提供できる

## 2. ユーザーストーリー

### US-001: 合法手の判定
**As a** リバーシゲームのプレイヤー
**I want to** 現在の盤面で自分が置ける合法な手をすべて知りたい
**So that** ルールに従った正しい手を打つことができる

### US-002: 盤面の可視化
**As a** リバーシゲームのプレイヤー
**I want to** 合法手が盤面上にマークされて表示されることを期待する
**So that** どこに置けるかが一目でわかる

### US-003: 両プレイヤーへの対応
**As a** リバーシゲームの実装者
**I want to** 黒番・白番の両方のプレイヤーに対応した合法手判定を行いたい
**So that** どちらの手番でも正しく動作するゲームを作れる

## 3. 受入基準（Acceptance Criteria）

### AC-001: 初期配置での黒番の合法手判定

**シナリオ**: 初期配置で黒番のプレイヤーが合法手を確認する

```gherkin
Given 盤面が以下の初期配置である
  """
  ........
  ........
  ........
  ...WB...
  ...BW...
  ........
  ........
  ........
  """
And 手番が黒（B）である

When プログラムを実行する

Then 以下の4箇所が合法手として表示される
  - (2, 4): 3行目5列目
  - (3, 5): 4行目6列目
  - (4, 2): 5行目3列目
  - (5, 3): 6行目4列目

And 出力は以下の形式である
  """
  ........
  ........
  ....0...
  ...WB0..
  ..0BW...
  ...0....
  ........
  ........
  B
  """
```

### AC-002: 初期配置での白番の合法手判定

**シナリオ**: 初期配置で白番のプレイヤーが合法手を確認する

```gherkin
Given 盤面が以下の初期配置である
  """
  ........
  ........
  ........
  ...WB...
  ...BW...
  ........
  ........
  ........
  """
And 手番が白（W）である

When プログラムを実行する

Then 以下の4箇所が合法手として表示される
  - (2, 3): 3行目4列目
  - (3, 2): 4行目3列目
  - (4, 5): 5行目6列目
  - (5, 4): 6行目5列目

And 出力は以下の形式である
  """
  ........
  ........
  ...0....
  ..0WB...
  ...BW0..
  ....0...
  ........
  ........
  W
  """
```

### AC-003: 合法手がない場合

**シナリオ**: プレイヤーに合法手がない状況を正しく判定する

```gherkin
Given 盤面上にどこに置いても相手のコマがひっくり返らない状態である

When プログラムを実行する

Then 合法手が0個であることが示される

And 出力された盤面に '0' のマークがない
```

### AC-004: 複数方向にひっくり返せる場合

**シナリオ**: 1つの手で複数方向の相手のコマをひっくり返せる場合

```gherkin
Given 盤面が以下の状態である
  """
  ........
  ........
  ...B....
  ..BWB...
  ...B....
  ........
  ........
  ........
  """
And 手番が白（W）である

When (3, 3)（4行目4列目）に白のコマを置く判定をする

Then この位置は合法手である

And この手により上下左右の4方向で黒のコマがひっくり返る
```

### AC-005: 端や角での合法手判定

**シナリオ**: 盤面の端や角でも正しく合法手を判定する

```gherkin
Given 盤面の端や角にコマが配置されている

When 端や角の位置について合法手判定を行う

Then 盤面の範囲内でのみ判定が行われる

And 盤面外を参照してエラーが発生しない
```

### AC-006: 入出力の正確性

**シナリオ**: 標準入力から盤面を読み込み、標準出力に結果を書き出す

```gherkin
Given 標準入力に以下の形式でデータが与えられる
  - 8行の盤面データ（各行8文字）
  - 1行の手番データ（'B' または 'W'）

When プログラムを実行する

Then 標準出力に以下の形式で結果が出力される
  - 8行の盤面データ（合法手の位置に '0' をマーク）
  - 1行の手番データ
```

## 4. 機能要件

### FR-001: 入力仕様
- **盤面データ**: 8行×8文字の文字列
  - `.`: 空マス
  - `B`: 黒のコマ
  - `W`: 白のコマ
- **手番データ**: 1文字（`B` または `W`）

### FR-002: 出力仕様
- **盤面データ**: 8行×8文字の文字列
  - 元の盤面データに、合法手の位置に `0` をマーク
  - 既存のコマ（`B`, `W`）や空マス（`.`）はそのまま保持
  - 合法手の位置のみ `0` に置き換える
- **手番データ**: 入力と同じ手番を出力

### FR-003: 合法手の定義
合法手とは、以下の条件を満たす手である：
1. **空マスである**: コマを置く位置が空マス（`.`）である
2. **相手のコマを挟める**: コマを置くことで、少なくとも1つ以上の相手のコマをひっくり返すことができる

**ひっくり返す条件**:
- 8方向（上下左右、斜め4方向）のいずれかにおいて
- 連続する相手のコマが存在し
- その先に自分のコマが存在する

### FR-004: 全方向の判定
- 8方向すべて（上、下、左、右、左上、右上、左下、右下）について判定を行う
- 複数方向で相手のコマをひっくり返せる場合も1つの合法手として扱う

## 5. 非機能要件

### NFR-001: 正確性
- すべての合法手を漏れなく判定する
- 合法でない手を誤って合法と判定しない

### NFR-002: 使いやすさ
- 標準入力/標準出力を使用し、パイプやリダイレクトで利用可能
- 出力形式は盤面を視覚的に理解しやすい形式である

### NFR-003: 拡張性
- 将来的に他の機能（実際のコマの配置、ゲーム進行）を追加できる設計
- ルール判定ロジックは再利用可能である

## 6. 用語集

| 用語 | 定義 |
|------|------|
| **合法手** | リバーシのルールに従って、コマを置くことができる位置 |
| **ひっくり返す** | 相手のコマを自分のコマに変えること |
| **空マス** | まだコマが置かれていない位置（`.` で表現） |
| **手番** | 現在どちらのプレイヤーの番かを示す（`B`: 黒番、`W`: 白番） |
| **盤面** | 8×8のマス目で構成されるリバーシのボード |

## 7. 制約条件

### 盤面サイズ
- 盤面は固定で8×8のサイズである
- 拡張性のため、将来的に可変サイズに対応できる設計が望ましい

### 入力の前提
- 入力データは常に正しい形式であることを前提とする
- 不正な入力（9行でない、8文字でない、不正な文字など）のエラーハンドリングは必須ではない

## 8. 成功指標

プログラムが以下を満たせば、仕様を満たしていると判断する：

1. **AC-001〜AC-006のすべての受入基準を満たす**
2. **問題文の入出力例と一致する結果を出力する**
3. **黒番・白番のどちらでも正しく動作する**
4. **合法手がない場合も正しく判定できる**

---

**補足**: この仕様書は「何を実現するか（What）」と「なぜ必要か（Why）」に焦点を当てています。技術的な実装方法（How）については、次のフェーズ「Plan（技術計画）」で詳細に設計します。
