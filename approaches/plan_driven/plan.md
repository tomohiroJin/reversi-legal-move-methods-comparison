# plan_driven アプローチ - 実装計画（TDD/BDD スタイル）

## 実装方針

この計画は **テスト駆動開発（TDD）** と **振る舞い駆動開発（BDD）** のアプローチを採用します：

- **Red-Green-Refactor サイクル**: テストを先に書き、実装を後から書く
- **日本語テスト**: テスト名は振る舞いを表す日本語で記述
- **各タスク完了時にコミット**: 進捗が Git 履歴で追跡可能
- **タスク実施前に確認**: 各タスク開始前にユーザーの承認を得る
- **外側と内側のループ**: BDD で機能テスト（外側）とユニットテスト（内側）を組み合わせる

## 進捗管理

各タスクの状態:
- ⏳ 未着手
- 🔄 実施中
- ✅ 完了（コミット済み）

---

## フェーズ0: 準備

### タスク0-1: ブランチ作成とディレクトリ構造準備
**目的**: 開発環境の準備

**作業内容**:
1. `git checkout -b feature/plan-driven` でブランチ作成
2. ディレクトリ構造作成:
   - `domain/`, `io/`, `tests/` ディレクトリ
   - 各 `__init__.py`
   - `requirements.txt`（pytest>=7.0.0）
3. `DESIGN.md` を作成（アーキテクチャと設計方針を明文化）
4. コミット

**完了定義**:
- ディレクトリ構造が整っている
- DESIGN.md が完成している
- Git コミット済み

**状態**: ✅ 完了（コミット: b0b5faf）

---

## フェーズ1: Board クラス（TDD サイクル）

### タスク1-1: Board クラスの振る舞いテストを書く（Red）
**目的**: Board クラスの期待する振る舞いをテストで表現

**作業内容**:
- `tests/test_board.py` を作成
- 以下のテストを日本語で記述:
  - `test_盤面を初期化できる()`
  - `test_指定位置のセルを取得できる()`
  - `test_位置が盤面内かどうか判定できる()`
  - `test_位置が空マスかどうか判定できる()`
  - `test_盤面データのコピーを取得できる()`
  - `test_相手プレイヤーを取得できる()`
- pytest 実行（失敗することを確認）

**完了定義**:
- テストが全て記述されている
- pytest 実行で失敗する（Board クラスがまだ存在しない）
- テスト名が振る舞いを表している

**状態**: ✅ 完了

---

### タスク1-2: Board クラスを実装してテストをパスさせる（Green）
**目的**: テストをパスする最小限の実装

**作業内容**:
- `domain/board.py` を作成
- Board クラスを実装:
  - `__init__(grid)`, `get_cell()`, `is_valid_position()`, `is_empty()`, `to_grid()`, `get_opponent()`
- 型ヒントと日本語 docstring を完備
- pytest 実行（全テストパス）

**完了定義**:
- Board クラスが実装されている
- 全テストがパスする
- 型ヒントと日本語 docstring が完備

**状態**: ✅ 完了

---

### タスク1-3: Board クラスのリファクタリングとコミット（Refactor）
**目的**: コードの品質向上

**作業内容**:
- コードレビュー（自己レビュー）
- 必要に応じてリファクタリング
- pytest 実行（テストが通ることを確認）
- Git コミット

**コミットメッセージ**:
```
feat(domain): Board クラスを TDD で実装

- 盤面の状態管理クラス
- 日本語テストで振る舞いを表現
- 全テストパス
```

**完了定義**:
- リファクタリング完了
- 全テストパス
- Git コミット済み

**状態**: ⏳ 未着手

---

## フェーズ2: GameRules クラス（TDD サイクル）

### タスク2-1: 方向別ひっくり返し判定のテストを書く（Red）
**目的**: `can_flip_in_direction` メソッドの振る舞いをテストで表現

**作業内容**:
- `tests/test_game_rules.py` を作成
- 以下のテストを日本語で記述:
  - `test_隣接マスに相手のコマがあり自分のコマで挟める場合ひっくり返せると判定する()`
  - `test_隣接マスに相手のコマがない場合ひっくり返せないと判定する()`
  - `test_相手のコマの先に自分のコマがない場合ひっくり返せないと判定する()`
  - `test_盤面外に出る場合ひっくり返せないと判定する()`
  - `test_8方向全てで正しく判定できる()`
- pytest 実行（失敗することを確認）

**完了定義**:
- テストが全て記述されている
- pytest 実行で失敗する
- テスト名が振る舞いを表している

**状態**: ⏳ 未着手

---

### タスク2-2: can_flip_in_direction メソッドを実装（Green）
**目的**: テストをパスする実装

**作業内容**:
- `domain/game_rules.py` を作成
- GameRules クラスの骨組みを実装
- `can_flip_in_direction()` メソッドを実装
- pytest 実行（全テストパス）

**完了定義**:
- `can_flip_in_direction()` が実装されている
- 全テストがパスする

**状態**: ⏳ 未着手

---

### タスク2-3: can_flip_in_direction のリファクタリングとコミット（Refactor）
**目的**: コードの品質向上

**作業内容**:
- コードレビュー
- リファクタリング
- pytest 実行（テスト通過確認）
- Git コミット

**コミットメッセージ**:
```
feat(domain): GameRules の方向別ひっくり返し判定を実装

- can_flip_in_direction メソッド
- 8方向全てに対応
- 日本語テストで振る舞いを表現
```

**完了定義**:
- リファクタリング完了
- 全テストパス
- Git コミット済み

**状態**: ⏳ 未着手

---

### タスク2-4: 合法手判定のテストを書く（Red）
**目的**: `is_legal_move` メソッドの振る舞いをテストで表現

**作業内容**:
- `tests/test_game_rules.py` にテスト追加:
  - `test_空マスで少なくとも1方向にひっくり返せる場合は合法手と判定する()`
  - `test_既にコマがある位置は合法手ではないと判定する()`
  - `test_どの方向にもひっくり返せない空マスは合法手ではないと判定する()`
- pytest 実行（失敗することを確認）

**完了定義**:
- テストが全て記述されている
- pytest 実行で失敗する

**状態**: ⏳ 未着手

---

### タスク2-5: is_legal_move メソッドを実装（Green）
**目的**: テストをパスする実装

**作業内容**:
- `is_legal_move()` メソッドを実装
- pytest 実行（全テストパス）

**完了定義**:
- `is_legal_move()` が実装されている
- 全テストがパスする

**状態**: ⏳ 未着手

---

### タスク2-6: is_legal_move のリファクタリングとコミット（Refactor）
**目的**: コードの品質向上とコミット

**作業内容**:
- リファクタリング
- pytest 実行
- Git コミット

**コミットメッセージ**:
```
feat(domain): GameRules の合法手判定を実装

- is_legal_move メソッド
- 全方向チェック
```

**完了定義**:
- Git コミット済み

**状態**: ⏳ 未着手

---

### タスク2-7: 全合法手列挙のテストを書く（Red）
**目的**: `find_all_legal_moves` メソッドの振る舞いをテストで表現

**作業内容**:
- `tests/test_game_rules.py` にテスト追加:
  - `test_初期配置で黒番の合法手4つを正しく列挙する()`
  - `test_初期配置で白番の合法手4つを正しく列挙する()`
  - `test_合法手がない場合は空リストを返す()`
- pytest 実行（失敗することを確認）

**完了定義**:
- テストが記述されている
- pytest 実行で失敗する

**状態**: ⏳ 未着手

---

### タスク2-8: find_all_legal_moves メソッドを実装（Green）
**目的**: テストをパスする実装

**作業内容**:
- `find_all_legal_moves()` メソッドを実装
- pytest 実行（全テストパス）

**完了定義**:
- `find_all_legal_moves()` が実装されている
- 全テストがパスする

**状態**: ⏳ 未着手

---

### タスク2-9: find_all_legal_moves のリファクタリングとコミット（Refactor）
**目的**: コードの品質向上とコミット

**作業内容**:
- リファクタリング
- pytest 実行
- Git コミット

**コミットメッセージ**:
```
feat(domain): GameRules の全合法手列挙を実装

- find_all_legal_moves メソッド
- 初期配置テスト通過
```

**完了定義**:
- Git コミット済み

**状態**: ⏳ 未着手

---

## フェーズ3: IO層（TDD サイクル）

### タスク3-1: InputReader のテストを書く（Red）
**目的**: 入力処理の振る舞いをテストで表現

**作業内容**:
- `tests/test_input_reader.py` を作成
- 以下のテストを日本語で記述:
  - `test_標準入力から盤面と手番を読み込める()`
  - `test_読み込んだ盤面がBoardオブジェクトとして正しく変換される()`
- pytest 実行（失敗することを確認）

**完了定義**:
- テストが記述されている
- pytest 実行で失敗する

**状態**: ⏳ 未着手

---

### タスク3-2: InputReader を実装（Green）
**目的**: テストをパスする実装

**作業内容**:
- `io/input_reader.py` を作成
- InputReader クラスを実装
- pytest 実行（全テストパス）

**完了定義**:
- InputReader が実装されている
- 全テストがパスする

**状態**: ⏳ 未着手

---

### タスク3-3: InputReader のリファクタリングとコミット（Refactor）
**目的**: コードの品質向上とコミット

**作業内容**:
- リファクタリング
- pytest 実行
- Git コミット

**コミットメッセージ**:
```
feat(io): InputReader を実装

- 標準入力から盤面と手番を読み込む
- Board オブジェクトに変換
```

**完了定義**:
- Git コミット済み

**状態**: ⏳ 未着手

---

### タスク3-4: OutputWriter のテストを書く（Red）
**目的**: 出力処理の振る舞いをテストで表現

**作業内容**:
- `tests/test_output_writer.py` を作成
- 以下のテストを日本語で記述:
  - `test_合法手を0でマークした盤面を出力できる()`
  - `test_手番も正しく出力される()`
- pytest 実行（失敗することを確認）

**完了定義**:
- テストが記述されている
- pytest 実行で失敗する

**状態**: ⏳ 未着手

---

### タスク3-5: OutputWriter を実装（Green）
**目的**: テストをパスする実装

**作業内容**:
- `io/output_writer.py` を作成
- OutputWriter クラスを実装
- pytest 実行（全テストパス）

**完了定義**:
- OutputWriter が実装されている
- 全テストがパスする

**状態**: ⏳ 未着手

---

### タスク3-6: OutputWriter のリファクタリングとコミット（Refactor）
**目的**: コードの品質向上とコミット

**作業内容**:
- リファクタリング
- pytest 実行
- Git コミット

**コミットメッセージ**:
```
feat(io): OutputWriter を実装

- 合法手を '0' でマーク
- 標準出力に書き込み
```

**完了定義**:
- Git コミット済み

**状態**: ⏳ 未着手

---

## フェーズ4: 統合（BDD - 外側のループ）

### タスク4-1: エンドツーエンドの機能テストを書く（Red）
**目的**: ユーザーストーリーをテストで表現（BDD の外側のループ）

**作業内容**:
- `test_reversi.py` を作成
- 以下のテストを日本語で記述:
  - `test_初期配置で黒番の合法手を正しく表示する()`
  - `test_初期配置で白番の合法手を正しく表示する()`
  - `test_合法手がない場合は0を表示しない()`
- pytest 実行（失敗することを確認）

**完了定義**:
- 機能テストが記述されている
- pytest 実行で失敗する

**状態**: ⏳ 未着手

---

### タスク4-2: メインエントリポイント実装（Green）
**目的**: 機能テストをパスさせる

**作業内容**:
- `reversi.py` を作成
- main() 関数を実装:
  1. InputReader で読み込み
  2. GameRules で合法手判定
  3. OutputWriter で出力
- pytest 実行（全テストパス）

**完了定義**:
- reversi.py が実装されている
- 機能テストが全てパスする

**状態**: ⏳ 未着手

---

### タスク4-3: 統合のリファクタリングとコミット（Refactor）
**目的**: コードの品質向上とコミット

**作業内容**:
- リファクタリング
- pytest 実行（全テスト通過）
- Git コミット

**コミットメッセージ**:
```
feat: メインエントリポイントを実装

- 全モジュールを統合
- エンドツーエンドテスト通過
- TDD/BDD サイクル完了
```

**完了定義**:
- Git コミット済み

**状態**: ⏳ 未着手

---

### タスク4-4: 手動テスト実行
**目的**: 実際の入出力で動作確認

**作業内容**:
- 問題文の例を標準入力として実行して動作確認
- 期待通りの出力が得られることを確認

**完了定義**:
- 問題文の例で正しい出力が得られる

**状態**: ⏳ 未着手

---

## フェーズ5: ドキュメント化

### タスク5-1: README.md 作成とコミット
**目的**: plan_driven アプローチの説明

**作業内容**:
- `approaches/plan_driven/README.md` を作成
- TDD/BDD アプローチの実装過程を記録
- Git コミット

**コミットメッセージ**:
```
docs: plan_driven の README を作成

- TDD/BDD アプローチの説明
- 実装過程の記録
```

**完了定義**:
- README.md が完成
- Git コミット済み

**状態**: ⏳ 未着手

---

### タスク5-2: プロジェクトルート README.md 更新とコミット
**目的**: プロジェクト全体のドキュメント更新

**作業内容**:
- ルート README.md に plan_driven の説明を追加
- Git コミット

**コミットメッセージ**:
```
docs: プロジェクトルート README に plan_driven を追加
```

**完了定義**:
- ルート README.md 更新
- Git コミット済み

**状態**: ⏳ 未着手

---

## 進捗サマリー

**完了**: タスク0-1（準備のみ、コミット未実施）
**次のタスク**: タスク0-1 のコミット → タスク1-1（Board クラステスト作成）
**総所要時間（見積もり）**: 約3〜4時間

---

## 注意事項

1. **各タスク実施前に確認を取る**: ユーザーの承認を得てから作業開始
2. **問題があれば都度相談**: 実装中に疑問や問題が発生したら即座に報告
3. **日本語テスト**: 全てのテスト名は振る舞いを表す日本語で記述
4. **TDD サイクル厳守**: Red → Green → Refactor → Commit の順序を守る
